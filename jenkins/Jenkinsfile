pipeline {
 agent any
 environment {
  IMAGE_TAG = "${build_number}"
 } 
 stages {
 
   stage ("checkout master") {
     steps {
	 echo "$GIT_BRANCH"
	 }
   } 
   
   stage ("docker build") {
   steps {
   echo "Building docker image"
   script {
   sh (script: 'docker images -a')
   sh (script:'''
         cd docker/
   docker build -t salahabbasi/azure_ci_cd:${BUILD_NUMBER} .
   docker images -a 
      ''')
   }
   } 
   }
     

  stage ('docker push'){
     steps {
		echo 'pushing image to docker hub'
	    	
	 docker.withregistry('','DockerID'  ) {
      def image = docker.build('salahabbasi/azure_ci_cd:${BUILD_NUMBER}')
	  image.push()
	   }
	 }
   }
     
   
 } 
} 
