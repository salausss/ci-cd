pipeline {
 agent any
 environment {
 registry = "https://hub.docker.com/salahabbasi"
 registryCredential = 'DockerID'
 dockerImage = ''
  IMAGE_TAG = "${build_number}"
 } 
 stages {
 
   stage ("checkout master") {
     steps {
	 echo "$GIT_BRANCH"
	 }
   } 
   
   stage ("docker build") {
   steps {
   echo "Building docker image"
   script {
   sh (script: 'docker images -a')
   sh (script:'''
         cd docker/
      docker build -t salahabbasi/alpine:$BUILD_NUMBER .
      docker images -a 
      ''')
   }
   } 
   }
   
   stage ('test') {
    steps {
   echo 'testing the build image'
   pwsh ( script:"""
   pytest ./tests/test_sample.py
   """
   )
   }
   }
      
               
   stage ('docker push'){
     steps {
		echo 'pushing image to docker hub'
	  script {  	
	 docker.withRegistry('',registryCredential ) {
     sh 'docker push salahabbasi/alpine:$BUILD_NUMBER'
		 }
	   }
	 }
   }
   
   }
  }

     
