pipeline {
 agent any
 environment {
  IMAGE_TAG = "${build_number}"
 } 
 stages {
 
   stage ("checkout master") {
     steps {
	 echo "$GIT_BRANCH"
	 }
   } 
   
   stage ("docker build") {
   steps {
   echo "Building docker image"
   script {
   sh '''
   docker images -a 
   def workspace = "${workspace}"
   cd docker/
   docker build -t salahabbasi/azure_ci_cd:${BUILD_NUMBER} .
      '''
   }
   } 
   }
      
               
   stage ('docker push'){
     steps {
		echo 'pushing image to docker hub'
	script {
    	
	 docker.withregistry('','DockerID'  ) {
      def image = docker.build('salahabbasi/azure_ci_cd:${BUILD_NUMBER}')
	  image.push()
	    }
	  }
	 }
   }
     
   
 } 
}
