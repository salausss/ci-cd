pipeline {

agent any

environment {
  registry = "https://hub.docker.com/"
  dockercredentials = "docker-cred"  
  dockerimage = "salahabbasi/centos:$BUILD_NUMBER"
  TRIVY_REPORT = "trivy-report.json"
}

stages {
 stage ('get branch') {
   steps {
		echo 'working branch is ' + "$GIT_BRANCH"
   }
 
 }
 
 stage ('build image') {
 steps {
	echo 'building image'
	script  {
	sh ( script: '''
	    docker images -a
     	    cd docker
     	    docker build -t ${dockerimage} .
	    docker images -a 
	''')
	
	
	}
 
 }
 }
 
stage ('Scan image') {
 steps {
	echo 'Scanning the image'
	sh ( script: '''
	trivy image --severity HIGH,CRITICAL -f json -o report.json salahabbasi/centos:2
	''')
	 
 }
	
}
 

}


}
